"use strict";var appCarSharingAppModule=angular.module("appCarSharingApp",["ui.bootstrap","ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngCookies","ng-bootstrap-datepicker"]);appCarSharingAppModule.factory("defaultInformation",["$cookies","$location",function(a,b){return{setDefultInfo:function(){a.email="luismi@gmail.com"}}}]),appCarSharingAppModule.config(["$routeProvider",function(a){a.when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/cars",{templateUrl:"views/carlist.html",controller:"CarlistCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignUpCtrl"}).when("/eventcreation",{templateUrl:"views/eventcreation.html",controller:"EventCreationCtrl"}).when("/joinevent",{templateUrl:"views/joinevent.html",controller:"JoinEventCtrl"}).otherwise({redirectTo:"/"})}]);var AVAILABLE_BRANDS="https://appcarsharing-api.herokuapp.com/rest/brand",CARS_BY_USER="https://appcarsharing-api.herokuapp.com/rest/user/cars",USER="https://appcarsharing-api.herokuapp.com/rest/user",userEmail="luismi@gmail.com",item="Get Started",appCarSharingAppModule=angular.module("appCarSharingApp");appCarSharingAppModule.controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.firtsOpc="Iniciar",a.secondOpc="Registrate",a.show=function(){a.firtsOpc="Cerrar",a.secondOpc=""}}]),appCarSharingAppModule.service("availableBrandsWebService",["$http",function(a){this.findAllAvailableBrands=function(){return a({method:"GET",url:AVAILABLE_BRANDS})}}]),appCarSharingAppModule.service("carsByUserWebService",["$http",function(a){this.findCarsByUser=function(){return a({method:"GET",url:CARS_BY_USER,params:{email:userEmail}})}}]),appCarSharingAppModule.service("addCarWebService",["$http",function(a){this.addCar=function(b){return a({method:"POST",url:CARS,params:{email:userEmail},data:b})}}]),angular.module("appCarSharingApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);var AVAILABLE_BRANDS="https://appcarsharing-api.herokuapp.com/rest/brand",CARS_BY_USER="https://appcarsharing-api.herokuapp.com/rest/user/cars",USER="https://appcarsharing-api.herokuapp.com/rest/user",userEmail="luismi@gmail.com",appCarSharingAppModule=angular.module("appCarSharingApp");appCarSharingAppModule.controller("CarlistCtrl",["$scope","carsByUserWebService","availableBrandsWebService",function(a,b,c){function d(){a.name="",a.memoryRAM="",a.processor="",a.internMemory="",a.year=0,a.price=0}a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],b.findCarsByUser().success(function(b){a.carlist=b}),c.findAllAvailableBrands().success(function(b){a.brandlist=b}),a.addCar=function(){var b={carriagePlate:a.carriagePlate,brand:{brand:a.brand},model:a.model,color:a.color,capacity:a.capacity};null!=b&&(a.carlist.push(b),d())}}]),appCarSharingAppModule.service("availableBrandsWebService",["$http",function(a){this.findAllAvailableBrands=function(){return a({method:"GET",url:AVAILABLE_BRANDS})}}]),appCarSharingAppModule.service("carsByUserWebService",["$http",function(a){this.findCarsByUser=function(){return a({withCredentials:!0,method:"GET",url:CARS_BY_USER+"/"+userEmail})}}]),appCarSharingAppModule.service("addCarWebService",["$http",function(a){this.addCar=function(b){return a({method:"POST",url:CARS+"/"+userEmail,data:b})}}]);var SAVE_USER_URL="https://appcarsharing-api.herokuapp.com/rest/user",userEmail="",appCarSharingAppModule=angular.module("appCarSharingApp");appCarSharingAppModule.controller("SignUpCtrl",["$scope","$http","saveUserWebService",function(a,b,c){function d(){a.firstName="",a.lastName="",a.email="",a.password="",a.birthDate=""}function e(a){return void 0==a||""==a?!0:void 0}a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"];var f="";a.signUp=function(){if(e(a.firstName)||e(a.lastName)||e(a.password)||e(a.birthDate))f="Los siguientes campos son obligatorios:\n\n-Nombres.\n-Apellidos.\n-Correo Electrónico.\n-Contraseña.\n-Fecha de Nacimiento.\n",alert(f);else if(e(a.email))f="Debe Ingresar un correo electrónico válido.\n",alert(f);else{var b={birthDate:a.birthDate,email:a.email,lastName:a.lastName,name:a.firstName,password:a.password};c.saveUser(b).success(function(a,b){200==b?(alert("El usuario ha sido guardado exitosamente."),d()):alert("No ha sido posible guardar el usuario.")})}a.password=""}}]),appCarSharingAppModule.service("saveUserWebService",["$http",function(a){this.saveUser=function(b){return a({method:"POST",url:SAVE_USER_URL,data:b})}}]);var CARS_BY_USER="https://appcarsharing-api.herokuapp.com/rest/user/cars",EVENT_CREATION="https://appcarsharing-api.herokuapp.com/rest/event",GOOGLE_MAPS_SERVICE="https://maps.google.com/maps/api/geocode/json?address=",GOOGLE_MAPS_SENSOR="&sensor=false;",Medellin="+Medellin",Antioquia="+Antioquia",Colombia="+Colombia",userEmail="luismi@gmail.com",lastName="Ruiz",name="Luismi",appCarSharingModule=angular.module("appCarSharingApp"),address=[];appCarSharingModule.controller("EventCreationCtrl",["$scope","carsByUserWebService","googleMapsWebService","createEventWebService",function(a,b,c,d){a.awesomeThings=["HTML5 Boilerplate","AngularJS"],$(function(){$("#sandbox-container .input-group.date").datepicker({format:"dd/mm/yyyy",clearBtn:!0,language:"es",autoclose:!0,todayHighlight:!0,toggleActive:!0})}),a.painted=!1,a.time=new Date,a.hstep=1,a.mstep=1,a.ismeridian=!0,a.toggleMode=function(){a.ismeridian=!a.ismeridian},a.update=function(){var b=new Date;b.setHours(14),b.setMinutes(0),a.time=b},a.clear=function(){a.time=new Date,a.car=void 0,a.source="",a.sourceGeometry=void 0,a.target="",a.targetGeometry=void 0,a.price="",a.eventDate=void 0,a.painted=!1,a.mapOptions.zoom=16,a.map=new google.maps.Map(document.getElementById("map"),a.mapOptions),address=[],a.markers=[]},b.findCarsByUser().success(function(b){a.carList=b}),a.createEvent=function(){var b=a.validateRequired();if(""!==b)return void alert("Los siguientes campos son obligatorios:\n"+b);if(a.target===a.source)return void alert("Por favor ingrese las dos direcciones diferentes.");if(!a.painted)return void alert("Por favor pinte las direcciones antes de crear el evento.");var c=a.eventDate.split("/"),e=c[0],f=parseInt(c[1]);f-=1;var g=c[2],h=a.time.getHours(),i=a.time.getMinutes(),j=new Date(g,f,e,h,i,0,0),k=new Date;if(Date.parse(j.toString())<Date.parse(k.toString()))return void alert("Por favor ingrese una hora y/o fecha posterior a la actual.");if(a.price<500)return void alert("Recuerde que el valor mínimo para un viaje es $500.");void 0!==a.sourceGeometry&&null!==a.sourceGeometry&&void 0!==a.sourceGeometry.desc&&""!==a.sourceGeometry.desc&&void 0!==a.sourceGeometry.lat&&""!==a.sourceGeometry.lat&&void 0!==a.sourceGeometry.lng&&""!==a.sourceGeometry.lng&&void 0!==a.targetGeometry&&null!==a.targetGeometry&&void 0!==a.targetGeometry.desc&&""!==a.targetGeometry.desc&&void 0!==a.targetGeometry.lat&&""!==a.targetGeometry.lat&&void 0!==a.targetGeometry.lng&&""!==a.targetGeometry.lng&&a.painted||alert("Por favor pinte las direcciones en el mapa antes de crear el evento.");var l={author:{email:userEmail,lastName:lastName,name:name},car:a.car,eventDate:Date.parse(j),createDate:Date.parse(new Date),source:{latitude:a.sourceGeometry.lat,longitude:a.sourceGeometry.lng,description:a.sourceGeometry.desc},target:{latitude:a.targetGeometry.lat,longitude:a.targetGeometry.lng,description:a.targetGeometry.desc},value:a.price};d.createEvent(l).success(function(b,c){200===c?(a.clear(),alert("El evento ha sido creado satisfactoriamente.")):alert("Se ha producido un error al crear el evento.\n\nPor favor póngase en contacto con el administrador.")})},a.removeTildes=function(a){return void 0==a||null==a?null:(a=a.replace("á","a"),a=a.replace("é","e"),a=a.replace("í","i"),a=a.replace("ó","o"),a=a.replace("ú","u"),a=a.replace("Á","A"),a=a.replace("É","E"),a=a.replace("Í","I"),a=a.replace("Ó","O"),a=a.replace("Ú","U"))},a.validateRequired=function(){var b="";return(void 0==a.source||""==a.source.trim())&&(b+="- Dirección de origen\n"),(void 0==a.target||""==a.target.trim())&&(b+="- Dirección de destino\n"),(void 0==a.car||null==a.car)&&(b+="- Carro\n"),isNaN(a.price)&&(b+="- Precio\n"),(void 0==a.eventDate||null==a.eventDate||""===a.eventDate.trim())&&(b+="- Fecha\n"),(void 0==a.time||null==a.time)&&(b+="- Hora"),b},a.showMarkers=function(){if((void 0==a.source||""==a.source||void 0==a.target||""==a.source)&&alert("Por favor ingrese tanto la dirección de origen como la de destino"),a.source===a.target)return void alert("Por favor ingrese dos direcciones diferentes.");a.mapOptions.zoom=14,a.map=new google.maps.Map(document.getElementById("map"),a.mapOptions),address=[],a.markers=[],a.source=a.removeTildes(a.source),a.target=a.removeTildes(a.target);var b=a.source.replace("#","%23");b=b.replace(/ /g,"+"),c.getCoordinates(b).success(function(b){return"OK"!=b.status?void alert("Por favor ingrese una dirección de origen correcta."):void(void 0!=b.results[0].geometry.location&&null!=b.results[0].geometry.location&&""!=b.results[0].geometry.location&&(a.sourceGeometry={lat:b.results[0].geometry.location.lat,lng:b.results[0].geometry.location.lng,desc:b.results[0].formatted_address},address[0]={lat:a.sourceGeometry.lat,lng:a.sourceGeometry.lng,desc:a.sourceGeometry.desc,title:a.source},a.createMarker(address[0])))});var d=a.target.replace("#","%23");d=d.replace(/ /g,"+"),c.getCoordinates(d).success(function(b){return"OK"!=b.status?void alert("Por favor ingrese una dirección de destino correcta."):void(void 0!=b.results[0].geometry.location&&null!=b.results[0].geometry.location&&""!=b.results[0].geometry.location&&(a.targetGeometry={lat:b.results[0].geometry.location.lat,lng:b.results[0].geometry.location.lng,desc:b.results[0].formatted_address},address[1]={lat:a.targetGeometry.lat,lng:a.targetGeometry.lng,desc:a.targetGeometry.desc,title:a.target},a.createMarker(address[1])))})},a.mapOptions={zoom:16,center:new google.maps.LatLng(6.253040800000001,-75.5645737),mapTypeId:google.maps.MapTypeId.TERRAIN},a.map=new google.maps.Map(document.getElementById("map"),a.mapOptions),a.markers=[];var e=new google.maps.InfoWindow;a.createMarker=function(b){a.painted=!0;var c=new google.maps.Marker({map:a.map,position:new google.maps.LatLng(b.lat,b.lng),title:b.title});c.content='<div class="infoWindowContent">'+b.desc+"</div>",google.maps.event.addListener(c,"click",function(){e.setContent("<h3>"+c.title+"</h3>"+c.content),e.open(a.map,c)}),a.markers.push(c)},a.openInfoWindow=function(a,b){a.preventDefault(),google.maps.event.trigger(b,"click")}}]),appCarSharingModule.service("googleMapsWebService",["$http",function(a){this.getCoordinates=function(b){return a({method:"GET",url:GOOGLE_MAPS_SERVICE+b+","+Medellin+","+Antioquia+","+Colombia+GOOGLE_MAPS_SENSOR})}}]),appCarSharingModule.service("createEventWebService",["$http",function(a){this.createEvent=function(b){return a({withCredentials:!1,method:"POST",url:EVENT_CREATION,data:b})}}]),appCarSharingModule.service("carsByUserWebService",["$http",function(a){this.findCarsByUser=function(){return a({withCredentials:!1,method:"GET",url:CARS_BY_USER+"/"+userEmail})}}]);var AVAILABLE_EVENTS="https://appcarsharing-api.herokuapp.com/rest/event/all",AVAILABLE_USERS="https://appcarsharing-api.herokuapp.com/rest/user",JOIN_EVENT="https://appcarsharing-api.herokuapp.com/rest/event/partner/",appCarSharingModule=angular.module("appCarSharingApp");appCarSharingModule.controller("JoinEventCtrl",["$scope","getAvailableEventsWebService","getAvailableUsersWebService","joinEventWebService",function(a,b,c,d){a.awesomeThings=["HTML5 Boilerplate","AngularJS"],b.getAvailableEvents().success(function(b,c){if(200!==c)return void alert("Se ha producido un error. Por favor cantáctese con el administrador o inténtelo de nuevo.");a.events=b;var d=a.events.length,e=Math.floor(Math.random()*d+1);a.event=a.events[e-1];var f=new Date(a.event.eventDate),g=f.getDate();10>g&&(g="0"+g);var h=f.getMonth()+1;10>h&&(h="0"+h);var i=f.getHours(),j="AM";i>12&&(i-=12,j="PM"),12===i&&(j="PM");var k=f.getMinutes();a.eventDate=""+g+"/"+h+"/"+f.getFullYear()+" - "+i+":"+k+" "+j,a.source=a.event.source,a.target=a.event.target,a.showMarkers()}),c.getAvailableUsers().success(function(b,c){if(200!==c)return void alert("Se ha producido un error. Por favor cantáctese con el administrador o inténtelo de nuevo.");a.users=b;var d=a.users.length,e=Math.floor(Math.random()*d+1);a.user=a.users[e-1]}),a.join=function(){if(a.event.author.email===a.user.email)return void alert("El usuario que se está tratando de unir al evento es el creador del mismo.");var b={name:a.user.name,lastName:a.user.lastName,email:a.user.email};d.joinEvent(b,a.event.id).success(function(b,c){if(204===c)alert("El usuario ya se unió al evento previamente.");else if(200===c){if(void 0!==b.messageResponse)return void alert(b.messageResponse);alert("El usuario se unió satisfactoriamente al evento."),a.event=b;var d=new Date(a.event.eventDate),e=d.getDate();10>e&&(e="0"+e);var f=d.getMonth()+1;10>f&&(f="0"+f);var g=d.getHours(),h="AM";g>12&&(g-=12,h="PM"),12===g&&(h="PM");var i=d.getMinutes();a.eventDate=""+e+"/"+f+"/"+d.getFullYear()+" - "+g+":"+i+" "+h,a.source=a.event.source,a.target=a.event.target,a.showMarkers()}else alert("Se ha producido un error. Por favor comuníquese con el administrador.")})},a.showMarkers=function(){(void 0==a.source||null==a.source||void 0==a.target||null==a.source)&&alert("No se encontró la dirección de origen o destino. Por favor contáctese con el administrador."),a.mapOptions.zoom=14,a.map=new google.maps.Map(document.getElementById("map"),a.mapOptions),a.markers=[];var b=a.source.description.split(",")[0],c={lat:a.source.latitude,lng:a.source.longitude,title:b,desc:a.source.description};a.createMarker(c),b=a.target.description.split(",")[0];var d={lat:a.target.latitude,lng:a.target.longitude,title:b,desc:a.target.description};a.createMarker(d)},a.mapOptions={zoom:16,center:new google.maps.LatLng(6.253040800000001,-75.5645737),mapTypeId:google.maps.MapTypeId.TERRAIN},a.map=new google.maps.Map(document.getElementById("map"),a.mapOptions),a.markers=[];var e=new google.maps.InfoWindow;a.createMarker=function(b){a.painted=!0;var c=new google.maps.Marker({map:a.map,position:new google.maps.LatLng(b.lat,b.lng),title:b.title});c.content='<div class="infoWindowContent">'+b.desc+"</div>",google.maps.event.addListener(c,"click",function(){e.setContent("<h3>"+c.title+"</h3>"+c.content),e.open(a.map,c)}),a.markers.push(c)},a.openInfoWindow=function(a,b){a.preventDefault(),google.maps.event.trigger(b,"click")}}]),appCarSharingModule.service("googleMapsWebService",["$http",function(a){this.getCoordinates=function(b){return a({method:"GET",url:GOOGLE_MAPS_SERVICE+b+","+Medellin+","+Antioquia+","+Colombia+GOOGLE_MAPS_SENSOR})}}]),appCarSharingModule.service("joinEventWebService",["$http",function(a){this.joinEvent=function(b,c){return a({withCredentials:!1,method:"PUT",url:JOIN_EVENT+c,data:b})}}]),appCarSharingModule.service("getAvailableEventsWebService",["$http",function(a){this.getAvailableEvents=function(){return a({withCredentials:!1,method:"GET",url:AVAILABLE_EVENTS})}}]),appCarSharingModule.service("getAvailableUsersWebService",["$http",function(a){this.getAvailableUsers=function(){return a({withCredentials:!1,method:"GET",url:AVAILABLE_USERS})}}]);